{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"curious-george.js","sourcesContent":["const GLOBAL = window;\nconst ERROR_MSG = {\n    INVALID_EMAIL : 'Invalid email address',\n    UNREACHABLE_API : 'API is unreachable',\n    UNKNOWN_PROVIDER : 'Unable to find CloudSponge provider',\n}\n\nconst DNS_MX_MAP = {\n    'aspmx.l.google.com'      : 'gmail',\n    'alt1.aspmx.l.google.com' : 'gmail',\n    'alt2.aspmx.l.google.com' : 'gmail',\n    'alt3.aspmx.l.google.com' : 'gmail',\n    'alt4.aspmx.l.google.com' : 'gmail',\n    'alt4.gmail-smtp-in.l.google.com' : 'gmail',\n    'alt3.gmail-smtp-in.l.google.com' : 'gmail',\n    'alt1.gmail-smtp-in.l.google.com' : 'gmail',\n    'gmail-smtp-in.l.google.com'      : 'gmail',\n    'alt2.gmail-smtp-in.l.google.com' : 'gmail',\n    \n    'mx1.biz.mail.yahoo.com'  : 'yahoo',    \n    'mx5.biz.mail.yahoo.com'  : 'yahoo',\n    'mta5.am0.yahoodns.net'   : 'yahoo',\n    'mta6.am0.yahoodns.net'   : 'yahoo',\n    'mta7.am0.yahoodns.net'   : 'yahoo',\n}\n\nclass CuriousGeorge {\n    \n    lookup(email) {\n        let host = this.getHostName(email);\n        return new Promise((resolve, reject) => {\n            if (host) {\n                let id = CuriousGeorge.getId();                \n                GLOBAL[`CuriousGeorge__jsonp__${id}`] = (response) => {\n                    if (!response) {\n                        reject(ERROR_MSG.UNREACHABLE_API);\n                    }\n                    else {\n                        resolve(response);\n                    }\n                    CuriousGeorge.cleanup(id);\n                }\n                CuriousGeorge.injectScript(id, host);\n            }\n            else {\n                reject(ERROR_MSG.INVALID_EMAIL);\n            }\n        })\n    }\n    \n    findProvider(email) {\n        return new Promise((resolve, reject) => {\n            this.lookup(email)\n            .then(response => {\n                let answer = response.answer || [];\n\n                for (let i = 0, len = answer.length; i < len; i++) {\n                    if (DNS_MX_MAP[answer[i].rdata[1]]) {\n                        resolve(DNS_MX_MAP[answer[i].rdata[1]]);\n                        return;\n                    }\n                }\n\n                reject(ERROR_MSG.UNKNOWN_PROVIDER);\n            })\n            .catch(err => {\n                reject(err);\n            }) \n        })\n    }\n    \n    getHostName(email) {\n        let match = /@(.+)$/.exec(email)\n        \n        if (match) {\n            return match[1];\n        }\n        return null\n    }\n    \n    static injectScript(id, host) {\n        let script = document.createElement('script');\n        let callback = `CuriousGeorge__jsonp__${id}`;\n        \n        script.id = `script_${id}`;\n        script.async = true;\n        script.onerror = GLOBAL[callback];\n        script.src = `http://dig.jsondns.org/IN/${host}/MX?callback=${callback}`\n        \n        document.head.appendChild(script);\n    }\n    \n    static cleanup(id) {\n        var script = document.getElementById(`script_${id}`);\n        \n        GLOBAL[`CuriousGeorge__jsonp__${id}`] = null;\n        script.parentNode.removeChild(script);\n    }\n    \n    static getId() {\n        if (!CuriousGeorge.__id__) {\n            CuriousGeorge.__id__ = 0;\n        }\n        return ++CuriousGeorge.__id__;\n    }\n}\n\n"]}